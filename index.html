<!DOCTYPE html>

<html>

<head>

    <title>Chess</title>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">

    <!-- Style -->
    <link rel="stylesheet" href="src/stylesheets/main.css">
    <link rel="stylesheet" href="src/stylesheets/chess.css">

    <!-- Javscripts -->
    <script src="src/javascripts/chess.js"></script>
    <script src="https://code.jquery.com/jquery-3.5.1.min.js"></script>

</head>

<body>

    <header>
        <div>
            <div id="title">
                <h1>Chess</h1>
                <div id="nav-toggle" class="mobile-only"></div>
            </div>
            <nav class="hide-on-mobile">
                <button id="new-game-btn">New Game</button>
                <div id="play-options" style="display: none;">
                    <button id="play-player">vs. Player</button>
                    <button id="play-ai-easy">vs. AI <span style="color: green">(easy)</span></button>
                    <button id="play-ai-normal">vs. AI <span style="color: dodgerblue">(normal)</span></button>
                    <button id="play-ai-hard">vs. AI <span style="color: salmon">(hard)</span></button>
                </div>
                <button>Save</button>
                <button>Share</button>
            </nav>
        </div>
        <footer class="hide-on-mobile"> © 2020 Trevor Richard </footer>
    </header>

    <div id="chess-container">
        <!-- container for the chess board -->
    </div>

    <footer class="mobile-only"> © 2020 Trevor Richard </footer>

    <!-- On Load -->
    <script>

        const _GET = {};

        var board;

        window.onload = function () {

            // Get GET vars
            parse_get_vars(_GET);

            // Event Listeners
            link_event_listeners();

            // Check for game load
            if (!check_load_game(_GET)) {

                // Append a default game board
                board = new Board({ parent_elem: $("#chess-container") });

            }

        }

        function parse_get_vars(_GET) {
            const url = new URL(location.href);

            const game = url.searchParams.get('game');
            if (game)
                _GET.game = game;

            let fen_str = url.searchParams.get('fen');
            if (fen_str) fen_str = unescape(fen_str);
            console.log(fen_str);
            if (fen_str)
                _GET.fen_str = fen_str;

            const side = url.searchParams.get('side');
            if (side)
                _GET.side = side;

        }

        function check_load_game(game_vars) {
            if (!game_vars) return false;
            game_vars.parent_elem = $("#chess-container");
            board = new Board(game_vars);
            return true;
        }

        function link_event_listeners() {
            // New Game
            $("#new-game-btn").on("click", () => {
                $("#play-options").toggle("fast");
            });

            // nav toggle
            $("#nav-toggle").on("click", () => {
                $("nav").toggle("fast");
            });

            // PvP
            $("#play-player").on("click", () => {
                window.location.assign("/?game=0");
            });

            // AI Easy
            $("#play-ai-easy").on("click", () => {
                window.location.assign("/?game=1");
            });

            // AI Normal
            $("#play-ai-normal").on("click", () => {
                window.location.assign("/?game=2");
            });

            // AI Hard
            $("#play-ai-hard").on("click", () => {
                window.location.assign("/?game=3");
            });

        }
    </script>

</body>

</html>